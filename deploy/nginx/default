server {
        listen 80;
        listen [::]:80;
        server_name gallerygateway.rit.edu;
        return 301 https://gallerygateway.rit.edu$request_uri;
}

server {
	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	root /var/www/html;
        
        index index.html;

        location ~* assets.*\.(?:css|js|svg|jpg)$ {
          try_files $uri =404;
          expires 1y;
          access_log off;
          add_header Cache-Control "public";
        }

        # Any route without an extension (e.g. /app)
        location / {
          # First attempt to serve request as file, then
          # as directory, then fall back to serving index.html.
          try_files $uri $uri/ /index.html;
        }

        location /backend {
                rewrite ^/backend(/.*)$ $1 break;
                proxy_pass http://localhost:3000;
        }

    server_name gallerygateway.rit.edu; # managed by Certbot

    listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/gallerygateway.rit.edu/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/gallerygateway.rit.edu/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}
